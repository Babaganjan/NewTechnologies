# # Используем официальный Node.js 22 образ
# FROM node:22-alpine

# # Устанавливаем рабочую директорию
# WORKDIR /app

# # Копируем package.json и package-lock.json (или yarn.lock)
# COPY package*.json ./

# # Устанавливаем все зависимости (включая dev-зависимости)
# RUN npm install

# # Копируем весь код проекта
# COPY . .

# # Открываем порт 3000
# EXPOSE 3000

# # Запускаем dev-сервер с Turbopack
# CMD ["npm", "run", "dev"]
FROM node:22-alpine

WORKDIR /app

# Копируем package.json для кэширования
COPY package*.json ./

# Устанавливаем зависимости
RUN npm install

# Создаём non-root user
RUN addgroup -g 1001 nodejs && adduser -D -u 1001 nextjs

# Меняем владельца
RUN chown -R nextjs:nodejs /app
USER nextjs

# Копируем код (но в runtime используйте volume)
COPY . .

EXPOSE 3000

# Healthcheck (опционально)
HEALTHCHECK --interval=30s --timeout=10s --start-period=5s --retries=3 \
  CMD wget --no-verbose --tries=1 --spider http://localhost:3000 || exit 1

CMD ["npm", "run", "dev"]
